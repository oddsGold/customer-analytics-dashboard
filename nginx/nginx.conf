server {
    listen 80;
    server_name your-domain.com;
    
    # ... ваші інші налаштування (SSL тощо) ...

    # Це ваш існуючий блок для Next.js
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # === НОВИЙ БЛОК ДЛЯ WEBSOCKETS ===
    # Всі запити, що починаються з /socket.io/ (це стандартний шлях socket.io)
    # будуть перенаправлені на наш окремий socket-server.
    location /socket.io/ {
        proxy_pass http://127.0.0.1:3001; # <-- Порт вашого socket-server.js
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade"; # <-- Дуже важливо для WebSockets!
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # === НОВИЙ БЛОК ДЛЯ ВОРКЕРА ===
    # Дозволяємо воркеру "стукати" на socket-server (але тільки зсередини)
    location /job-complete {
        allow 127.0.0.1; # Дозволити запити тільки з localhost
        deny all;        # Заборонити всім іншим
        
        proxy_pass http://127.0.0.1:3001;
    }
}

